module Game

open "UnityEngine.dll"
open UnityEngine

scene World = {
  Zombies	: [Zombie]
  Truck		: Jeep

  rule Zombies = 
    [for a in Zombies do
	 where (not a.Destroyed)
	 select a]

  rule Zombies = 
    wait 2.0f
    yield new Zombie(Truck.Position) :: Zombies

  Create() = {
    Zombies = []
    Truck = Jeep()
  }
}

entity Jeep = {
  inherit UnityJeep
  test : int

  rule test = test + 1

  Create()= {
    UnityJeep = UnityJeep.Instantiate()
    test = 0
  }
}

entity Zombie = {
  inherit UnityZombie
  TruckPos : Vector3
	
  rule Position, speed, Destroyed = 
    if Position = TruckPos then // collision
      yield new Vector3(0.0f,0.0f,0.0f), 0.0f, true
    else // not in range
      yield Position, 1.0f*dt, false

  rule currenta,targeta = Position, TruckPos

  rule Rotation, Destroyed = 
    if Position = TruckPos then
      yield new Quaternion(0.0f,0.0f,0.0f,0.0f), true
    else
      yield Rotation, false

  Create(pos : Vector3) = 
  {
    TruckPos = pos
    UnityZombie = UnityZombie.Instantiate(pos)
  }
}
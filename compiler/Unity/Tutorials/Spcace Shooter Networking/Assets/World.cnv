module Game

open "UnityEngine.dll"
open UnityEngine

worldEntity World = {
  
    Host : bool
    Players : [Player]
    MainMenu : Menu
    StarShip : Ship

    Create()={
        Players = []
        Host = false
        MainMenu = new Menu()
        StarShip = new Ship()
    }    
}

entity Player={

    Identifier : int
    
    Create()={
        Identifier = 2
    }
}

entity Ship = {
    inherit UnityShip

    Health : int
    
    rule Position = 
        if (Input.GetKey(KeyCode.A)) then
            yield Position + Vector3((-2.0f*dt), 0.0f, 0.0f)
        if (Input.GetKey(KeyCode.D)) then   
            yield Position + Vector3((2.0f*dt), 0.0f, 0.0f)

    Create()={
        Health = 98;
        Base = UnityShip.Instantiate(Vector3(0.0f, -2.7f, -15.0f))
    }
}

entity Menu = {
    inherit UnityMenu

    Connect : Button
    isHost : Toggle

    rule Connect.ButtonText =
        if isHost.Toggled then   
            yield "Host game!"
        else
            yield "Connect to game!"
    
    rule Connect.Clicked =    
        if Connect.Clicked then
            Application.LoadLevel("Game")
            yield false
        else 
            yield false

    Create()={
    Base = UnityMenu.Find()
    Connect = new Button("Connect")
    isHost = new Toggle("InstanceHost")
    }
}

entity Button = {
    inherit UnityButton

    Create(n : string)={
    Base = UnityButton.Find(n)
    } 

}

entity Toggle = {
    inherit UnityToggle
    
    Create(n : string) = {
    Base = UnityToggle.Find(n)
    }
}

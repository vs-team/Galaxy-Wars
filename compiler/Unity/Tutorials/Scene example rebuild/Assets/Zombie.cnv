module Zombie

open "UnityEngine.dll"
open UnityEngine

entity GroupZombie = { 
  inherit UnityGroup
  ZombieFollowers : [Zombie]

  rule ZombieFollowers =  
    wait dt
    let z = 
      [for a in U_Zombies do
       select (new Zombie(a))] 
    yield z
    yield []
    wait false

  Create(sps : Vector3, amount : int) =
  {
    Base = UnityGroup.Instantiate(sps, amount)
    ZombieFollowers = []
  }
}

entity Zombie = {
  inherit UnityZombie2

  rule Life = 
    yield 140.0f
    wait false

  rule WaitingOnStandstill =
    wait WaitingOnStandstill
    Debug.Log(LastHitRigidBody.velocity.sqrMagnitude)
    wait (LastHitRigidBody.velocity.sqrMagnitude < 0.01f)
    yield false

  rule SoundToPlay = 
    wait tim
    yield WhichSoundToPlay

  rule Destroyed = 
    wait (Vector3.Distance(Position, world.Jeep.Value.Position) > 410.0f)
    yield true

  rule Dest =
    if Ragdolled then
      wait not Ragdolled
      wait 5.0f //Standing up animation
      yield world.Jeep.Value.Position // world.Jeep.Value.TruckTarget check each side of truck. pick closest c#
    else
      yield world.Jeep.Value.Position // world.Jeep.Value.TruckTarget check each side of truck. pick closest c#

  Create(trans : Transform) = 
  { 
    Base = UnityZombie2.Find(trans)
  }
}

entity ZombieGroupDestroyer = {
  inherit UnityDestroyer

  Create(a : float, b : Vector3) = {  
    Base = UnityDestroyer.instantiate(a, b)
  }
}